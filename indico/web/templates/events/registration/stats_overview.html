{#
 # This file is part of Indico.
 # Copyright (C) 2002 - 2014 European Organization for Nuclear Research (CERN).
 #
 # Indico is free software; you can redistribute it and/or
 # modify it under the terms of the GNU General Public License as
 # published by the Free Software Foundation; either version 3 of the
 # License, or (at your option) any later version.
 #
 # Indico is distributed in the hope that it will be useful, but
 # WITHOUT ANY WARRANTY; without even the implied warranty of
 # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 # General Public License for more details.
 #
 # You should have received a copy of the GNU General Public License
 # along with Indico;if not, see <http://www.gnu.org/licenses/>.
 #}
{% extends 'events/registration/_stats_box.html' %}
{% block content -%}
{% set height = data.countries|length * 24 + 28 %}
    <div class="i-badges-list">
        <div class="i-badge">
            <span class="i-badge-value" data-value="{{ data.registrants|length }}"></span>
            <span class="i-badge-legend">{% trans %}Registrants{% endtrans %}</span>
        </div>
        <div class="i-badge">
            <span class="i-badge-value" data-value="{{ data.days_left }}"></span>
            <span class="i-badge-legend">{% trans %}Days left<br>to register{% endtrans %}</span>
        </div>
        {% set taken, total, progress = data.availability %}
        <div class="i-badge">
            <span class="i-badge-value" {% if data.num_countries %} data-value="{{ data.num_countries}}" {% endif %}>
                {% if not data.num_countries %} &ndash; {% endif %}
            </span>
            <span class="i-badge-legend">{% trans %}Countries{% endtrans %}</span>
        </div>
    </div>
    {%- if total > 0 -%}
        <div class="stats-item">
            <span>{% trans %}Availability{% endtrans %}</span>
            <span>
                <span class="i-progress">
                    <span class="i-progress-bar" data-progress={{ '{:%}'.format(progress) }}></span>
                    <span class="i-progress-label">
                        {%- if total == taken %}
                            {%- trans %}event full{% endtrans -%}
                        {%- else -%}
                            {%- trans places=total-taken %}{{ places }} places available{% endtrans -%}
                        {% endif -%}
                    </span>
                </span>
            </span>
        </div>
    {% endif %}
     {% if data.num_countries %}
        <div class="stats-item">
            <span>{% trans %}Repartition of countries{% endtrans %}</span><span></span>
        </div>
        <div id="countriesPlot" style="width:500px; height:{{height}}px;"></div>
        <script>
            $(document).ready(function generateBasicStats() {
                var countries = {{ data.countries|tojson }}
                var countriesPlot = $.jqplot('countriesPlot', [countries], {
                    animate: !$.jqplot.use_excanvas,
                    animateReplot: !$.jqplot.use_excanvas,
                    grid: { shadow: false },
                    height: {{ height }},
                    highlighter: {
                        show: true,
                        sizeAdjust: 7.5
                    },
                    seriesColors: ['#007CAC'],  // indico blue
                    seriesDefaults: {
                        renderer: $.jqplot.BarRenderer,
                        rendererOptions: {
                            animation: { speed: 1000 },
                            barDirection: 'horizontal',
                            barWidth: 18,
                            // highlightMouseOver: true,
                            // highlightColors: ['#EDF3FD']
                        },
                        pointLabels: {
                            show: true,
                            location: 'w',
                            xpadding: 4,
                            edgeTolerance: -2
                        },
                        shadow: false,
                        highlighter: {
                            tooltipLocation: 's',
                        }
                    },
                    axes: {
                        yaxis: {
                            pad: 8,
                            renderer: $.jqplot.CategoryAxisRenderer,
                            labelRenderer: $.jqplot.CanvasAxisLabelRenderer,
                            tickRenderer: $.jqplot.CanvasAxisTickRenderer,
                            tickOptions: {
                                showGridline: false,
                                markSize: 0,
                                tickSpacing: 24,
                                showLabel: true,
                            }
                        },
                        xaxis: {
                            min: 0,
                            padMax: 0,
                            tickRenderer: $.jqplot.CanvasAxisTickRenderer,
                            tickOptions: { markSize: 0 }
                        }
                    },
                    legend: { show: false }
                });
            });
        </script>
    {% endif %}
{%- endblock %}
