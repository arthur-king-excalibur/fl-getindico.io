<div ng-controller="BillableCtrl" ng-init="input = {}">
    <table>
        <tr>
            <td align="left">
                <span>{{ 'Arrival date' | i18n }}</span>
                <span class="regFormMandatoryField">*</span>
            </td>
            <td align="left">
                <ng-form name="nestedFormArrival"
                    ng-init="input.arrival = userdata.accommodation.arrivalDate">
                    <select id="arrivalDate" name="arrivalDate" required
                        ng-model="input.arrival"
                        ng-change="updateArrival(input.arrival); input.departure = ''"
                        ng-class="{hasError: validationStarted && nestedFormArrival.$invalid}">
                        <option value="" selected>--{{ 'select a date' | i18n }}--</option>
                        <option ng-repeat="date in section.arrivalDates"
                            value="{{ date[0] }}"
                            ng-selected="date[0] === userdata.accommodation.arrivalDate">
                            {{ date[1] }}
                        </option>
                    </select>
                </ng-form>
            </td>
        </tr>
        <tr>
            <td align="left">
                <span>Departure date</span>
                <span class="regFormMandatoryField">*</span>
            </td>
            <td align="left">
                <ng-form name="nestedFormDeparture"
                    ng-init="input.departure = userdata.accommodation.departureDate">
                    <select id="departureDate" name="departureDate" required
                        ng-model="input.departure"
                        ng-class="{hasError: validationStarted && nestedFormDeparture.$invalid}">
                        <option value="" selected>--{{ 'select a date' | i18n }}--</option>
                        <option ng-repeat="date in section.departureDates | filter:possibleDeparture"
                            value="{{ date[0] }}"
                            ng-selected="date[0] === userdata.accommodation.departureDate">
                            {{ date[1] }}
                        </option>
                    </select>
                </ng-form>
            </td>
        </tr>
    </table>

    <ng-form name="nestedFormAccommodation">
        <table>
            <tr>
                <td>
                    <span id="accommodationTypeLabel" class="bold">
                        {{ 'Select your accommodation:' | i18n }}
                    </span>
                    <span class="regFormMandatoryField">*</span>
                </td>
                <td ng-if="validationStarted && nestedFormAccommodation.$invalid">
                    <span class="error-message-tag">
                        {{ 'You must chose one accommodation option' | i18n }}
                    </span>
                </td>
            </tr>
            <tr ng-if="section.items.length === 0">
                <td class="section-placeholder">
                    {{ 'There are no available accommodation options' | i18n }}.
                </td>
            </tr>
            <tr ng-repeat="item in section.items">
                <td align="left" class="accommodation-option-item">
                    <input type="radio" nd-radio-extend
                        id="{{ item.id }}"
                        name="accommodation_type"
                        value="{{ item.id }}"
                        ng-model="userdata.accommodation.accommodationType.id"
                        ng-disabled="isDisabled(item)"
                        ng-required="hasPlacesLeft(item) && !item.cancelled"
                        ng-checked="item.id == userdata.accommodation.accommodationType.id"/>
                    {{ item.caption }}

                    <font ng-if="item.cancelled && !hasPlacesLeft(item)" color="red">
                        ({{ 'currently not available' | i18n }})
                    </font>
                    <span ng-if="hasPlacesLimit(item)">
                        <font ng-if="!item.cancelled && !hasPlacesLeft(item)" color="red">
                            ({{ 'no places left' | i18n }})
                        </font>
                        <font ng-if="!item.cancelled && hasPlacesLeft(item)" color="green">
                            [{{ item.noPlacesLeft }} {{ "place(s) left" | i18n }}]
                        </font>
                    </span>
                </td>
                <td align="right">
                    <span ng-if="item.billable" class="regFormPrice">{{ item.price }}</span>
                    <span ng-if="item.billable" class="regFormCurrency">{{ currency }}</span>
                    <span ng-if="item.billable">{{ "per night" | i18n }}</span>
                </td>
            </tr>
        </table>
    </ng-form>
</div>
