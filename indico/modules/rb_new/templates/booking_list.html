{% extends 'events/management/base.html' %}
{% from 'forms/_form.html' import form_row %}

{% block title %}
    {% trans %}Event bookings{% endtrans %}
{% endblock %}

{% block content %}
    <div class="action-box event-bookings">
        <div class="section">
            <div class="text">
                <div class="label">
                    {%- trans %}Event{% endtrans -%}
                </div>
                {{ event.title }}
            </div>
            <div class="toolbar">
                <a href="#" class="i-button highlight book-btn">
                    {%- trans %}Book{% endtrans -%}
                </a>
            </div>
        </div>
        {% if has_unlinked_contribs %}
            <div class="section searchable-field">
                <div class="text">
                    <div class="label">
                        {%- trans %}Contribution{% endtrans -%}
                    </div>
                    {{ form_row(form.contribution, skip_label=true, hide_description=true) }}
                </div>
                <div class="toolbar">
                    <a href="#" class="i-button highlight book-btn disabled">
                        {%- trans %}Book{% endtrans -%}
                    </a>
                </div>
            </div>
        {% endif %}
        {% if has_unlinked_session_blocks %}
            <div class="section searchable-field">
                <div class="text">
                    <div class="label">
                        {%- trans %}Session block{% endtrans -%}
                    </div>
                    {{ form_row(form.session_block, skip_label=true, hide_description=true) }}
                </div>
                <div class="toolbar">
                    <a href="#" class="i-button highlight book-btn disabled">
                        {%- trans %}Book{% endtrans -%}
                    </a>
                </div>
            </div>
        {% endif %}
    </div>
    {{ reservations }}
    <script>
        (function() {
            'use strict';

            $('#contribution, #session_block').on('change', (e) => {
                const $target = $(e.currentTarget);
                $target.closest('.searchable-field').find('.book-btn').toggleClass('disabled', !$target.val());
                const linkType = {contribution: 'contribution',
                    session_block: 'sessionBlock',
                }[$target.attr('id')];
                const linkId = +$target.val();
                // TODO: Change book link to inject object id
            });
        })();
    </script>
{% endblock %}


