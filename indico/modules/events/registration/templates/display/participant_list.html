{% extends 'events/registration/display/_event_registration_base.html' %}
{% from 'message_box.html' import message_box %}

{% block title %}
    {% trans %}Participant List{% endtrans %}
{% endblock %}

{% block subtitle %}
    {% set count = registrations | length %}
    {% if count > 1 %}
        {%- trans %}{{ count }} participants{% endtrans -%}
    {% endif %}
{% endblock %}

{% macro table_header(columns) %}
    <thead>
        <tr class="i-table">
            {% if show_checkin %}
            <th class="i-table checkbox-column" data-sorter="false"></th>
            {% endif %}
            {% for column in columns %}
                <th class="i-table">{{ column }}</th>
            {% endfor %}
        </tr>
    </thead>
{% endmacro %}

{% macro table_row(registration) %}
    <tr class="i-table">
        {% if show_checkin %}
            <td class="i-table center"
                {% if registration.checked_in %}title="{% trans %}Checked in{% endtrans %}"{% endif %}>
                {% if registration.checked_in %}<i class="icon-checkmark"></i>{% endif %}
            </td>
        {% endif %}
        {% for column in registration.columns %}
            <td class="i-table"
                {% if column.sort_key %} data-text="{{ column.sort_key }}"{% endif %}>
                {{ column.text }}
            </td>
        {% endfor %}
{% endmacro %}

{% macro participant_table(columns, registrations) %}
    <table class="i-table tablesorter">
        {{ table_header(columns) }}
        <tbody>
            {% for name, personal_data, checked_in in registrations %}
                {{ table_row({"checked_in": checked_in, "columns": [
                    {"text": (title or '') + " " + name, "sort_key": name},
                    {"text": personal_data.position or ''},
                    {"text": personal_data.affiliation} ]}) }}
            {% endfor %}
        </tbody>
    </table>
{% endmacro %}

{% block content %}
    {% if not published %}
        {% call message_box('info', fixed_width=true) %}
            {% trans %}There are no published registrations.{% endtrans %}
        {% endcall %}
    {% elif not registrations %}
        {% call message_box('info', fixed_width=true) %}
            {% trans %}There are no participants yet.{% endtrans %}
        {% endcall %}
    {% else %}
        <div class="registrations report">
            {{ participant_table(["Full name", "Position", "Affiliation"], registrations) }}
        </div>
    {% endif %}

    <script>
        $('.registrations .tablesorter').tablesorter({
            cssAsc: 'header-sort-asc',
            cssDesc: 'header-sort-desc',
            headerTemplate: ''
        });
    </script>
{% endblock %}
