{% from 'attachments/_attachments.html' import get_attachment_icon %}

{% macro render_attachment(attachment, has_label=false) %}
    <a class="i-button attachment {{ get_attachment_icon(attachment) }} {% if attachment.is_protected %}is-protected{% endif %} {% if has_label %}has-label{% endif %}"
       href="{{ attachment.download_url }}" target="_blank"
       title="{{ attachment.description or attachment.title }}
              {% if attachment.is_protected %}({% trans %}Protected{% endtrans %}){% endif %}">
        {#- -#}
        {% if not has_label -%}
            <span class="title">{{ attachment.title }}</span>
        {%- endif %}
        {#- -#}
    </a>
{% endmacro %}

{% macro render_folder(folder) -%}
    <div class="folder toolbar {% if folder.is_protected %}is-protected{% endif %}">
        <div class="attachments group">
            <span class="i-button label" title="{{ folder.description }}">{{ folder.title }}</span>
            {% if folder.attachments|count <= 2 %}
                {%- for attachment in folder.attachments -%}
                    {{ render_attachment(attachment, has_label=true) }}
                {%- endfor -%}
            {% else %}
                <a class="i-button arrow" data-toggle="dropdown"></a>
                <ul class="dropdown">
                {%- for attachment in folder.attachments -%}
                    <li><a href="{{ attachment.download_url }}" target="_blank"
                           class="attachment {{ get_attachment_icon(attachment) }} {% if attachment.is_protected %}is-protected{% endif %}"
                          >{{ attachment.title }}</a>
                    </li>
                    {{ template_hook('event-display-after-attachment', attachment=attachment, top_level=false) }}
                {%- endfor -%}
                </ul>
            {% endif %}
        </div>
    </div>
{%- endmacro %}

{% macro render_attachments_folders(item=none, files=[], folders=[]) %}
    {% set files = item.attached_items.files if item else files %}
    {% set folders = item.attached_items.folders if item else folders %}

    <span class="folder folder-root toolbar">
        {% for attachment in files %}
            {{ render_attachment(attachment) }}
            {{ template_hook('event-display-after-attachment', attachment=attachment, top_level=true) }}
        {% endfor %}
    </span>

    {%- for folder in folders -%}
        {{ render_folder(folder) }}
    {%- endfor %}
{% endmacro %}
